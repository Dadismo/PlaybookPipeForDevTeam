pipeline {
    agent none
    environment {  // double check the block before any push
        github_link = 'xxx' // paste github link
        gh_repo_name ='xxx' // paste repo name
        DEV_PBS = 'abc.yml,def.yml' // list of PB to STASH, add or remove PBs if needed
    }
    stages{
        stage ('cloning repo, testing & stashing files in gitnode') {
            agent {
                label 'gitnode'
            }
            step {
                script {
                    // cloning
                    sh "git clone -b Dev ${github_link}"
                    
                    // change directory
                    dir ("${gh_repo_name}")

                    // run some testing on the syntax of the code w/ yamllint
                        sh 'yamllint .'  // will look only for yml files in the branch
                    // stash the Dev PB
                        stash(name: 'DEVPB', includes: "${DEV_PBS}") 
                    // stash the QA PB
                      //  stash(name: 'QAPB', includes: "${QA_PBS}") 
                    // stash the PROD PB
                        // stash(name: 'PRODPB', includes: "${PROD_PBS}") 
                }
            }
        }
post {
    always {
         // Archive the YAML linting results
        archiveArtifacts artifacts: 'yamllint-results.txt'
    }
}    
        stage('Unstash DEVPB') {
            agent {
                label 'ansible_master1'
            }
            steps {
                // Unstash the DEVPB in ansible master 1
                unstash(name: 'DEVPB')
                
                // Move the unstashed files to a specific directory
                dir('path/to/DEVdirectory') {
                    sh 'mv $WORKSPACE/* .'
                }
            }
        }
    }
}
